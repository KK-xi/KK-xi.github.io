<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.jpg">
  <link rel="icon" type="image/png" href="/img/avatar.jpg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="记录生活">
  <meta name="author" content="kiki">
  <meta name="keywords" content="CV">
  <title>GAN跑mnist数据集 - KK&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- 自定义样式保持在最底部 -->


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Welcome to here.</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/work/">工作</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/life/">生活</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  星期一, 四月 27日 2020, 12:12 中午
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    1.2k 字
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      6 分钟
                  </span>
                

                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
            <div class="markdown-body">
              <h2 id="gan网络在手写数字数据集mnist上的运用">GAN网络在手写数字数据集mnist上的运用</h2>
<p>前言：最近学了几种GAN网络，想自己动手跑一跑，就搭了个很简单的普通GAN网络。</p>
<p><strong>一、网络架构</strong><br>
GAN的原理就不详细说明了，有很多很好资源都可以学习到，在这里定义的GAN网络结构如下（图来自灵魂画手<a href="https://zhuanlan.zhihu.com/p/85908702" target="_blank" rel="noopener">知乎</a>）： <img src="https://img-blog.csdnimg.cn/20200316163116180.png?,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjM5MDc3,size_16,color_FFFFFF,t_70" srcset="/img/loading.gif" alt="framework"> <font color="red">结构</font> ：input --&gt; 全连接层 --&gt; leak Relu --&gt; dropout20% --&gt; 全连接层 --&gt; tanh --&gt;output。（生成器和判别器的网络架构一样） <br> <font color="red">判别器的目的是</font>：1. 对于真实图片，D要为其打上标签1；对于生成图片，D要为其打上标签0。 <br> <font color="red">生成器的目的是 </font>：对于生成的图片，G希望D打上标签1。</p>
<p><strong>二、源代码</strong><br>
part1，import~~</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="im">import</span> tensorflow <span class="im">as</span> tf</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="im">import</span> numpy <span class="im">as</span> np</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="im">import</span> pickle</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="im">from</span> tensorflow.examples.tutorials.mnist <span class="im">import</span> input_data</a></code></pre></div>
<p>part2,定义generator 和 discriminator * Generator</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">def</span> generator(noise_img,reuse):</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">    生成器</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">    :param noise_img:</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">    :return:</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    alpha <span class="op">=</span> <span class="fl">0.01</span>      <span class="co"># parameter of leaky ReLU</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">    out_dim <span class="op">=</span> <span class="dv">784</span>     <span class="co"># the output size of the generator, MNIST images are 28*28, into a length of 784 array.</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">    g_units <span class="op">=</span> <span class="dv">128</span>    <span class="co"># hidden layer nodes</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">    <span class="cf">with</span> tf.variable_scope(<span class="st">&quot;generator&quot;</span>, reuse<span class="op">=</span>reuse):</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">        <span class="co"># hidden layer</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">        hidden1 <span class="op">=</span> tf.layers.dense(noise_img, g_units)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">        <span class="co"># leaky ReLU</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16">        hidden1 <span class="op">=</span> tf.maximum(alpha <span class="op">*</span> hidden1, hidden1)</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">        <span class="co"># dropout</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19">        hidden1 <span class="op">=</span> tf.layers.dropout(hidden1, rate<span class="op">=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb2-20" data-line-number="20"></a>
<a class="sourceLine" id="cb2-21" data-line-number="21">        <span class="co"># logits &amp; outputs,tf.layers.dense——full connection</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22">        logits <span class="op">=</span> tf.layers.dense(hidden1, out_dim)</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">        <span class="co"># the pixel range of MNIST  dataset is 0-1, the generated image range is (-1,1).</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24">        outputs <span class="op">=</span> tf.tanh(logits)</a>
<a class="sourceLine" id="cb2-25" data-line-number="25"></a>
<a class="sourceLine" id="cb2-26" data-line-number="26">    <span class="cf">return</span> logits, outputs</a></code></pre></div>
<ul>
<li>Discriminator</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">def</span>  discriminator(img,reuse):</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">    discriminator</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">    :param img:</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">    :return:</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    alpha<span class="op">=</span><span class="fl">0.01</span>      </a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    d_units<span class="op">=</span><span class="dv">128</span>    </a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="cf">with</span> tf.variable_scope(<span class="st">&quot;discriminator&quot;</span>, reuse<span class="op">=</span>reuse):</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">        <span class="co"># hidden layer</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">        hidden2 <span class="op">=</span> tf.layers.dense(img, d_units)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">        <span class="co"># leaky ReLU</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">        hidden2 <span class="op">=</span> tf.maximum(alpha <span class="op">*</span> hidden2, hidden2)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">        <span class="co"># dropout</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16">        hidden2 <span class="op">=</span> tf.layers.dropout(hidden2, rate<span class="op">=</span><span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">        <span class="co"># logits &amp; outputs</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">        logits <span class="op">=</span> tf.layers.dense(hidden2,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">        outputs <span class="op">=</span> tf.tanh(logits)</a>
<a class="sourceLine" id="cb3-20" data-line-number="20"></a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    <span class="cf">return</span> logits, outputs</a></code></pre></div>
<p>part3，mian() —初始化、训练、抽样评估</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">def</span> GAN_mnist():</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">    simple GAN generate handwritten digital picture</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">    :return:</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    mnist <span class="op">=</span> input_data.read_data_sets(<span class="st">&#39;./mnist_dataset/&#39;</span>,one_hot<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    img_size <span class="op">=</span> mnist.train.images[<span class="dv">0</span>].shape[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">    noise_size <span class="op">=</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">    <span class="co"># 1、parameters preparing</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11">    learning_rate <span class="op">=</span> <span class="fl">0.001</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12">    smooth <span class="op">=</span> <span class="fl">0.1</span>    <span class="co"># label smoothing</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">    n_sample <span class="op">=</span> <span class="dv">25</span> <span class="co"># number of samples</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">    samples<span class="op">=</span>[]</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"></a>
<a class="sourceLine" id="cb4-16" data-line-number="16">    tf.reset_default_graph()</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">    <span class="co"># 2、dataset preparing</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18">    real_img <span class="op">=</span> tf.placeholder(tf.float32, [<span class="va">None</span>, img_size], name<span class="op">=</span><span class="st">&#39;real_img&#39;</span>) <span class="co"># image size784=28*28</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">    <span class="co"># noise size input generator</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20">    noise_img <span class="op">=</span> tf.placeholder(tf.float32, [<span class="va">None</span>, noise_size], name<span class="op">=</span><span class="st">&#39;noise_img&#39;</span>)</a>
<a class="sourceLine" id="cb4-21" data-line-number="21"></a>
<a class="sourceLine" id="cb4-22" data-line-number="22">    <span class="co"># 3、Generator generate image</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23">    g_logits,g_outputs <span class="op">=</span> generator(noise_img,reuse<span class="op">=</span><span class="va">False</span>)</a>
<a class="sourceLine" id="cb4-24" data-line-number="24">    <span class="co"># generator的loss</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"></a>
<a class="sourceLine" id="cb4-26" data-line-number="26">    <span class="co"># 4、discriminator discriminates between true and false</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27">    d_logits_real, d_outputs_real <span class="op">=</span> discriminator(real_img , reuse<span class="op">=</span><span class="va">False</span>)</a>
<a class="sourceLine" id="cb4-28" data-line-number="28">    d_logits_fake, d_outputs_fake <span class="op">=</span> discriminator(g_outputs , reuse<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb4-29" data-line-number="29"></a>
<a class="sourceLine" id="cb4-30" data-line-number="30">    <span class="co"># 5、calculate loss</span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31">    <span class="co"># discriminator_loss：discriminate real image + discriminate fake image</span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"></a>
<a class="sourceLine" id="cb4-33" data-line-number="33">    <span class="co"># test the discriminant discriminant ability</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34">    d_loss_real <span class="op">=</span> tf.reduce_mean(tf.nn.sigmoid_cross_entropy_with_logits(</a>
<a class="sourceLine" id="cb4-35" data-line-number="35">        logits<span class="op">=</span>d_logits_real,labels<span class="op">=</span>tf.ones_like(d_logits_real)) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> smooth))</a>
<a class="sourceLine" id="cb4-36" data-line-number="36"></a>
<a class="sourceLine" id="cb4-37" data-line-number="37">    <span class="co"># test the discriminant discriminant ability</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38">    d_loss_fake <span class="op">=</span> tf.reduce_mean(tf.nn.sigmoid_cross_entropy_with_logits(</a>
<a class="sourceLine" id="cb4-39" data-line-number="39">        logits<span class="op">=</span>d_logits_fake,labels<span class="op">=</span>tf.zeros_like(d_logits_fake)))</a>
<a class="sourceLine" id="cb4-40" data-line-number="40"></a>
<a class="sourceLine" id="cb4-41" data-line-number="41">    <span class="co"># sum_loss</span></a>
<a class="sourceLine" id="cb4-42" data-line-number="42">    d_loss <span class="op">=</span> tf.add(d_loss_real, d_loss_fake)</a>
<a class="sourceLine" id="cb4-43" data-line-number="43"></a>
<a class="sourceLine" id="cb4-44" data-line-number="44">    <span class="co"># generator_loss</span></a>
<a class="sourceLine" id="cb4-45" data-line-number="45">    g_loss <span class="op">=</span> tf.reduce_mean(tf.nn.sigmoid_cross_entropy_with_logits(</a>
<a class="sourceLine" id="cb4-46" data-line-number="46">        logits<span class="op">=</span>d_logits_fake,labels<span class="op">=</span>tf.ones_like(d_logits_fake)) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> smooth))</a>
<a class="sourceLine" id="cb4-47" data-line-number="47"></a>
<a class="sourceLine" id="cb4-48" data-line-number="48">    <span class="co"># 6、Gradient descent loss optimization</span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49">    train_vars <span class="op">=</span> tf.trainable_variables()</a>
<a class="sourceLine" id="cb4-50" data-line-number="50">    <span class="co"># generator_tensor</span></a>
<a class="sourceLine" id="cb4-51" data-line-number="51">    g_vars <span class="op">=</span> [var <span class="cf">for</span> var <span class="kw">in</span> train_vars <span class="cf">if</span> var.name.startswith(<span class="st">&quot;generator&quot;</span>)]</a>
<a class="sourceLine" id="cb4-52" data-line-number="52">    <span class="co"># discriminator_tensor</span></a>
<a class="sourceLine" id="cb4-53" data-line-number="53">    d_vars <span class="op">=</span> [var <span class="cf">for</span> var <span class="kw">in</span> train_vars <span class="cf">if</span> var.name.startswith(<span class="st">&quot;discriminator&quot;</span>)]</a>
<a class="sourceLine" id="cb4-54" data-line-number="54">    <span class="co"># optimizer</span></a>
<a class="sourceLine" id="cb4-55" data-line-number="55">    d_train_opt <span class="op">=</span> tf.train.AdamOptimizer(learning_rate).minimize(d_loss, var_list<span class="op">=</span>d_vars)</a>
<a class="sourceLine" id="cb4-56" data-line-number="56">    g_train_opt <span class="op">=</span> tf.train.AdamOptimizer(learning_rate).minimize(g_loss, var_list<span class="op">=</span>g_vars)</a>
<a class="sourceLine" id="cb4-57" data-line-number="57"></a>
<a class="sourceLine" id="cb4-58" data-line-number="58">    <span class="co"># 7、trianing part</span></a>
<a class="sourceLine" id="cb4-59" data-line-number="59">    <span class="co"># train parameters</span></a>
<a class="sourceLine" id="cb4-60" data-line-number="60">    batch_size <span class="op">=</span> <span class="dv">64</span></a>
<a class="sourceLine" id="cb4-61" data-line-number="61">    epoch <span class="op">=</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb4-62" data-line-number="62">    n_batch<span class="op">=</span> mnist.train.num_examples <span class="op">//</span> batch_size   <span class="co"># Calculate how many lots there are</span></a>
<a class="sourceLine" id="cb4-63" data-line-number="63"></a>
<a class="sourceLine" id="cb4-64" data-line-number="64">    losses <span class="op">=</span> [] <span class="co"># store loss</span></a>
<a class="sourceLine" id="cb4-65" data-line-number="65"></a>
<a class="sourceLine" id="cb4-66" data-line-number="66">    <span class="co"># start training</span></a>
<a class="sourceLine" id="cb4-67" data-line-number="67">    <span class="cf">with</span> tf.Session() <span class="im">as</span> sess:</a>
<a class="sourceLine" id="cb4-68" data-line-number="68">        sess.run(tf.global_variables_initializer())</a>
<a class="sourceLine" id="cb4-69" data-line-number="69"></a>
<a class="sourceLine" id="cb4-70" data-line-number="70">        <span class="cf">for</span> e <span class="kw">in</span> <span class="bu">range</span>(epoch):</a>
<a class="sourceLine" id="cb4-71" data-line-number="71">            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n_batch):</a>
<a class="sourceLine" id="cb4-72" data-line-number="72">                batch <span class="op">=</span> mnist.train.next_batch(batch_size)</a>
<a class="sourceLine" id="cb4-73" data-line-number="73">                batch_images <span class="op">=</span> batch[<span class="dv">0</span>].reshape((batch_size,<span class="dv">784</span>))  <span class="co"># batch[0]represents image,reshape-&gt; batch_size*784</span></a>
<a class="sourceLine" id="cb4-74" data-line-number="74">                batch_images <span class="op">=</span> batch_images <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span>   <span class="co"># scale the pixel of images for outputs of tanh are (-1,1)</span></a>
<a class="sourceLine" id="cb4-75" data-line-number="75">                batch_noise <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, size<span class="op">=</span>(batch_size, <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb4-76" data-line-number="76"></a>
<a class="sourceLine" id="cb4-77" data-line-number="77">                _ <span class="op">=</span> sess.run(d_train_opt, feed_dict<span class="op">=</span>{real_img: batch_images, noise_img: batch_noise})</a>
<a class="sourceLine" id="cb4-78" data-line-number="78">                _ <span class="op">=</span> sess.run(g_train_opt, feed_dict<span class="op">=</span>{noise_img: batch_noise})</a>
<a class="sourceLine" id="cb4-79" data-line-number="79"></a>
<a class="sourceLine" id="cb4-80" data-line-number="80">            <span class="co"># calculate the loss after each epoch</span></a>
<a class="sourceLine" id="cb4-81" data-line-number="81">            train_loss_d_real <span class="op">=</span> sess.run(d_loss_real,feed_dict<span class="op">=</span>{real_img:batch_images,noise_img:batch_noise})</a>
<a class="sourceLine" id="cb4-82" data-line-number="82">            train_loss_d_fake <span class="op">=</span> sess.run(d_loss_fake,feed_dict<span class="op">=</span>{real_img:batch_images,noise_img:batch_noise})</a>
<a class="sourceLine" id="cb4-83" data-line-number="83"></a>
<a class="sourceLine" id="cb4-84" data-line-number="84">            train_loss_d <span class="op">=</span> sess.run(d_loss,feed_dict<span class="op">=</span>{real_img: batch_images, noise_img: batch_noise})</a>
<a class="sourceLine" id="cb4-85" data-line-number="85"></a>
<a class="sourceLine" id="cb4-86" data-line-number="86">            train_loss_g <span class="op">=</span> sess.run(g_loss,feed_dict<span class="op">=</span>{noise_img: batch_noise})</a>
<a class="sourceLine" id="cb4-87" data-line-number="87"></a>
<a class="sourceLine" id="cb4-88" data-line-number="88">            <span class="bu">print</span>(<span class="st">&quot;Epoch </span><span class="sc">{}</span><span class="st">/</span><span class="sc">{}</span><span class="st">...&quot;</span>.<span class="bu">format</span>(e <span class="op">+</span> <span class="dv">1</span>, epoch),</a>
<a class="sourceLine" id="cb4-89" data-line-number="89">                  <span class="st">&quot;Discriminator Loss: </span><span class="sc">{:.4f}</span><span class="st">(Real: </span><span class="sc">{:.4f}</span><span class="st"> + Fake: </span><span class="sc">{:.4f}</span><span class="st">)...&quot;</span>.<span class="bu">format</span>(train_loss_d, train_loss_d_real,</a>
<a class="sourceLine" id="cb4-90" data-line-number="90">                                                                                      train_loss_d_fake),</a>
<a class="sourceLine" id="cb4-91" data-line-number="91">                  <span class="st">&quot;Generator Loss: </span><span class="sc">{:.4f}</span><span class="st">&quot;</span>.<span class="bu">format</span>(train_loss_g))</a>
<a class="sourceLine" id="cb4-92" data-line-number="92"></a>
<a class="sourceLine" id="cb4-93" data-line-number="93">            <span class="co"># record the values of loss</span></a>
<a class="sourceLine" id="cb4-94" data-line-number="94">            losses.append((train_loss_d, train_loss_d_real, train_loss_d_fake, train_loss_g))</a>
<a class="sourceLine" id="cb4-95" data-line-number="95"></a>
<a class="sourceLine" id="cb4-96" data-line-number="96"></a>
<a class="sourceLine" id="cb4-97" data-line-number="97"></a>
<a class="sourceLine" id="cb4-98" data-line-number="98"></a>
<a class="sourceLine" id="cb4-99" data-line-number="99">            <span class="co"># sample to evaluate</span></a>
<a class="sourceLine" id="cb4-100" data-line-number="100">            sample_noise <span class="op">=</span> np.random.uniform(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>, size<span class="op">=</span>(n_sample, noise_size))</a>
<a class="sourceLine" id="cb4-101" data-line-number="101">            gen_samples <span class="op">=</span> sess.run(generator(noise_img, reuse<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb4-102" data-line-number="102">                                   ,feed_dict<span class="op">=</span>{noise_img: sample_noise})</a>
<a class="sourceLine" id="cb4-103" data-line-number="103">            samples.append(gen_samples)</a>
<a class="sourceLine" id="cb4-104" data-line-number="104"></a>
<a class="sourceLine" id="cb4-105" data-line-number="105"></a>
<a class="sourceLine" id="cb4-106" data-line-number="106">    <span class="co"># record the data of samples</span></a>
<a class="sourceLine" id="cb4-107" data-line-number="107">    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;train_samples.pkl&#39;</span>, <span class="st">&#39;wb&#39;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb4-108" data-line-number="108">        pickle.dump(samples, f)</a>
<a class="sourceLine" id="cb4-109" data-line-number="109"></a>
<a class="sourceLine" id="cb4-110" data-line-number="110">    <span class="co"># plot loss curve</span></a>
<a class="sourceLine" id="cb4-111" data-line-number="111">    losses <span class="op">=</span> np.array(losses)</a>
<a class="sourceLine" id="cb4-112" data-line-number="112">    plt.figure(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-113" data-line-number="113">    plt.subplot(<span class="dv">221</span>)</a>
<a class="sourceLine" id="cb4-114" data-line-number="114">    plt.plot(losses.T[<span class="dv">0</span>], label<span class="op">=</span><span class="st">&#39;Discriminator Total Loss&#39;</span>)</a>
<a class="sourceLine" id="cb4-115" data-line-number="115">    plt.subplot(<span class="dv">222</span>)</a>
<a class="sourceLine" id="cb4-116" data-line-number="116">    plt.plot(losses.T[<span class="dv">1</span>], label<span class="op">=</span><span class="st">&#39;Discriminator Real Loss&#39;</span>)</a>
<a class="sourceLine" id="cb4-117" data-line-number="117">    plt.subplot(<span class="dv">223</span>)</a>
<a class="sourceLine" id="cb4-118" data-line-number="118">    plt.plot(losses.T[<span class="dv">2</span>], label<span class="op">=</span><span class="st">&#39;Discriminator Fake Loss&#39;</span>)</a>
<a class="sourceLine" id="cb4-119" data-line-number="119">    plt.subplot(<span class="dv">224</span>)</a>
<a class="sourceLine" id="cb4-120" data-line-number="120">    plt.plot(losses.T[<span class="dv">3</span>], label<span class="op">=</span><span class="st">&#39;Generator&#39;</span>)</a>
<a class="sourceLine" id="cb4-121" data-line-number="121">    plt.title(<span class="st">&quot;Training Losses&quot;</span>)</a>
<a class="sourceLine" id="cb4-122" data-line-number="122">    plt.show()</a>
<a class="sourceLine" id="cb4-123" data-line-number="123"></a>
<a class="sourceLine" id="cb4-124" data-line-number="124">    <span class="cf">with</span> <span class="bu">open</span>(<span class="st">&#39;train_samples.pkl&#39;</span>, <span class="st">&#39;rb&#39;</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb4-125" data-line-number="125">        samples <span class="op">=</span> pickle.load(f)</a>
<a class="sourceLine" id="cb4-126" data-line-number="126"></a>
<a class="sourceLine" id="cb4-127" data-line-number="127">    rows, cols <span class="op">=</span> <span class="dv">5</span>, <span class="dv">5</span></a>
<a class="sourceLine" id="cb4-128" data-line-number="128">    fig, axes <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">7</span>), nrows<span class="op">=</span>rows, ncols<span class="op">=</span>cols, sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>)</a>
<a class="sourceLine" id="cb4-129" data-line-number="129">    <span class="cf">for</span> ax, img <span class="kw">in</span> <span class="bu">zip</span>(axes.flatten(), samples[epoch <span class="op">-</span> <span class="dv">1</span>][<span class="dv">1</span>]):</a>
<a class="sourceLine" id="cb4-130" data-line-number="130">        ax.xaxis.set_visible(<span class="va">False</span>)</a>
<a class="sourceLine" id="cb4-131" data-line-number="131">        ax.yaxis.set_visible(<span class="va">False</span>)</a>
<a class="sourceLine" id="cb4-132" data-line-number="132">        ax.imshow(img.reshape((<span class="dv">28</span>, <span class="dv">28</span>)), cmap<span class="op">=</span><span class="st">&#39;Greys_r&#39;</span>)</a>
<a class="sourceLine" id="cb4-133" data-line-number="133">    plt.show()</a></code></pre></div>
<p>其中samples的部分就是抽样25个size为100的noise_samples送入生成器经过200epoch之后生成器生成图像，结果在第三部分。最后那几段是画图部分。</p>
<p>part4，you know</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">    GAN_mnist()</a></code></pre></div>
<p><strong>三、看结果</strong></p>
<p>训练时候的loss，这里epoch取的200： <br> 左上是Discriminator Total Loss，右上是Discriminator Real Loss，左下Discriminator Fake Loss，最后是Generator loss。 <img src="https://img-blog.csdnimg.cn/20200316161700318.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjM5MDc3,size_16,color_FFFFFF,t_70" srcset="/img/loading.gif" alt="loss"></p>
<p>生成的数字示例： <img src="https://img-blog.csdnimg.cn/20200316223639385.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjM5MDc3,size_16,color_FFFFFF,t_70" srcset="/img/loading.gif" alt="运行结果"> 只是200epoch的结果，感觉隐隐约约能看出来是啥数字，可以试试修改epoch，运行一次有点久了，下次跑cGAN网络。如果有什么错误欢迎指出，谢谢~~</p>

            </div>
            <hr>
            <div>
              <p>
                
                  <span>
                <i class="iconfont icon-inbox"></i>
                    
                      <a class="hover-with-bg" href="/categories/work/">work</a>
                      &nbsp;
                    
                      <a class="hover-with-bg" href="/categories/work/GAN/">GAN</a>
                      &nbsp;
                    
                  </span>&nbsp;&nbsp;
                
                
                  <span>
                <i class="iconfont icon-tag"></i>
                    
                      <a class="hover-with-bg" href="/tags/GAN/">GAN</a>
                    
                  </span>
                
              </p>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/04/27/%E4%B9%A0%E8%A7%84%E5%88%92/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile"> 学习规划</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/04/07/%E6%96%87%E3%80%8AGround-to-Aeria-lImage-Geo-Localization-With-a-Hard-Exemplar-Reweighting-Triplet-Loss%E3%80%8B/">
                        <span class="hidden-mobile">论文《Ground-to-Aeria lImage Geo-Localization With a Hard Exemplar Reweighting Triplet Loss》</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-md">
    <div class="container custom post-content mx-auto">
                   我在你身边，等着你回答
    </div>
  </div>


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>








<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "GAN跑mnist数据集&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 80,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>












</body>
</html>
